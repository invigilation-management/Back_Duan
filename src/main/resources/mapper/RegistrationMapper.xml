<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatisplus.mapper.RegistrationMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.example.mybatisplus.model.domain.Registration">
        <id column="registration_id" property="registrationId" />
        <result column="faculty_faculty_id" property="facultyFacultyId" />
        <result column="batch_batch_id" property="batchBatchId" />
        <result column="compensation_compensation_id" property="compensationCompensationId" />
        <result column="state" property="state" />
        <result column="pass_or_not" property="passOrNot" />
        <result column="gender" property="gender" />
        <result column="true_faculty_id" property="trueFacultyId" />
        <result column="college" property="college" />
        <result column="true_faculty_name" property="trueFacultyName" />
        <result column="edu_qualification" property="eduQualification" />
        <result column="tele" property="tele" />
        <result column="tele_backup" property="teleBackup" />
        <result column="birthday" property="birthday" />
        <result column="avatar" property="avatar" />
        <result column="target_campus" property="targetCampus" />
    </resultMap>


    <resultMap id="WaitingPage" type="com.example.mybatisplus.model.domain.Registration">
        <id property="registrationId" column="registration_id"/>
        <result property="trueFacultyName" column="true_faculty_name"/>
        <result property="facultyFacultyId" column="faculty_faculty_id"/>
        <result property="batchBatchId" column="batch_batch_id"/>
        <result property="targetCampus" column="target_campus"/>
    </resultMap>

    <select id="selectWaitingPage" resultMap="BaseResultMap">
        SELECT
            r.registration_id AS registrationId,
            r.true_faculty_name AS trueFacultyName,
            u.faculty_faculty_id AS facultyFacultyId,
            b.batch_info AS batchInfo,
            r.target_campus AS targetCampus,
            f.level AS level,
            f.college_college_id AS collegeCollegeId
        FROM
            registration r
                JOIN
            user u
                JOIN
            batch b ON r.batch_batch_id = b.batch_id
                JOIN
            faculty f ON u.faculty_faculty_id = f.faculty_id
        WHERE
            u.user_id = #{userId}
          AND r.pass_or_not IS NULL
          AND f.college_college_id = (SELECT college_college_id FROM user WHERE user_id = #{userId})
          AND (
                        (SELECT level FROM faculty WHERE faculty_id = (SELECT faculty_faculty_id FROM user WHERE user_id = #{userId})) = 1 AND r.state = 1
                OR
                        (SELECT level FROM faculty WHERE faculty_id = (SELECT faculty_faculty_id FROM user WHERE user_id = #{userId})) = 4 AND r.state = 2
                OR
                        (SELECT level FROM faculty WHERE faculty_id = (SELECT faculty_faculty_id FROM user WHERE user_id = #{userId})) = 5 AND r.state = 3
                OR
                        (SELECT level FROM faculty WHERE faculty_id = (SELECT faculty_faculty_id FROM user WHERE user_id = #{userId})) = 2 AND r.state = 4
            )

    </select>


</mapper>
